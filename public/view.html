<!doctype html>
<html>
<head><meta charset="utf-8"><title>View Recipes</title></head>
<body>
  <nav>
    <a href="/index.html">Home</a> |
    <a href="/view.html">View recipes</a> |
    <a href="/create.html">Post recipe</a> |
    <a href="/edit.html">Edit recipe</a> |
    <a href="/delete.html">Delete recipe</a>
  </nav>

  <h1>View Recipes</h1>

  <button id="load" type="button">Load my recipes</button>
  <div id="out"></div>

  <script src="/config.js"></script>
  <script>
    const out = document.getElementById("out");

    document.getElementById("load").addEventListener("click", load);

    async function load() {
      out.textContent = "Loading...";
      const url = `${window.API_BASE}/recipeService?authorId=${encodeURIComponent(window.AUTHOR_ID)}`;
      const resp = await fetch(url);
      if (!resp.ok) { out.textContent = `Failed (${resp.status})`; return; }

      const recipes = await resp.json();
      if (!recipes.length) { out.textContent = "No recipes yet."; return; }

      out.innerHTML = "";
      for (const r of recipes) {
        const div = document.createElement("div");
        div.innerHTML = `
          <hr>
          <h3>${escapeHtml(r.title)}</h3>
          <p><b>id:</b> ${escapeHtml(r.id)}</p>
          <p><b>ingredients:</b><br>${escapeHtml(r.ingredients)}</p>
          <p><b>instructions:</b><br>${escapeHtml(r.instructions)}</p>
          ${r.imageUrl ? `<p><img src="${r.imageUrl}" width="250"></p>` : ""}
        `;
        out.appendChild(div);
      }
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>
</body>
</html>
